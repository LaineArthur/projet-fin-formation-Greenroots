<%- include('partials/header') %> 

<main class="is-flex-grow-1 mb-6">
  <section class="section mb-6"> 
    <div class="container has-text-centered">
      <div class="columns is-vcentered mb-4">
        <div class="column"> 
          <h1 class="title-page has-text-centered-mobile has-text-left-tablet has-text-weight-bold">Panier</h1>
        </div>
      </div>

  <% if (typeof total === 'number' && total > 0) { %>
    <% cartItems.forEach((item, index) => { %>
      <div class="content-card is-flex is-justify-content-space-around p-2 mb-6" data-tree-id="<%= item.id %>">
        <img src="../public/images/photos/<%= item.image %>" alt="Photo de <%= item.name %>">
        <div class="is-flex is-flex-direction-column is-flex-wrap-nowrap is-justify-content-space-between">
          <p><span class="has-text-weight-semibold">Nom : </span><%= item.name %></p>
          <p><span class="has-text-weight-semibold">Taille : </span><%= item.size %> m</p>
          <p><span class="has-text-weight-semibold">Prix : </span><span class="item-price"><%= item.price_ttc %></span> €</p>
          <p><span class="has-text-weight-semibold">Sous-total : </span><span class="item-subtotal"><%= item.subtotal.toFixed(2) %></span> € </p>
          <p><span class="has-text-weight-semibold">Quantité : </span> </p>
            <div class="field has-addons"> 
              <p class="control">
                <button type="button" class="button is-primary decrement-btn" data-tree-id="<%= item.id %>">-</button>
              </p>
              <p class="control">
                <input class="input has-text-centered quantity-input" 
       type="number" 
       value="<%= item.quantity %>" 
       min="1" 
       max="10000" 
       step="1" 
       data-tree-id="<%= item.id %>" 
       style="width: 60px;"
       oninput="this.value = this.value.replace(/[^0-9]/g, ''); if(this.value < 1) this.value = 1; if(this.value > 10000) this.value = 10000;">
              </p>
              <p class="control">
                <button type="button" class="button is-primary increment-btn" data-tree-id="<%= item.id %>">+</button>
              </p>
            </div>
          </p>

        </div>
      </div>
    <% }) %>

    <div class="control">
      <div class="total-section has-text-right">
        <p class="text-green total-ttc"><span id="cart-total">Total TTC : <%= total.toFixed(2) %> €</span></p>
        <div class="buttons is-right">

          <button id="clear-cart" class="button is-large is-warning mt-2">Vider le panier</button>   
            <form action="/create-checkout-session" method="POST">
              <button class="button is-custom-green is-large mt-2" type="submit">Passer au paiement</button>
            </form>        
        </div>
      </div>
    <% } else { %>
      <div class="empty-cart-message has-text-centered is-size-4 my-6">
        <p>Votre panier est vide</p>
      </div>
    <% } %>
    
  </main>
  <script src="/public/js/quantity.js"></script>
</body>


<%- include('partials/footer') %>
